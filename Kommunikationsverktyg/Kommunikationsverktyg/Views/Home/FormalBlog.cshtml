@model Kommunikationsverktyg.Models.ViewModels.ListFormalBlogViewModel

@{
    ViewBag.Title = "Formell blogg";
}
<head>
    <link href="~/Content/Site.css" rel="stylesheet" type="text/css" />
</head>

<h2 id="formalblogH2">Formell Blogg</h2>
@using (Html.BeginForm("FormalBlog", "Home", FormMethod.Post, new { enctype = "multipart/form-data", id = "formet" }))
{
    <div class="form-horizontal col-lg-12">

        <h4 id="formalblogH4">Gör ett inlägg</h4>
        <hr />
        @Html.ValidationSummary("", new { @class = "text-danger" })
        <div class="form-group col-lg-12">
            @Html.TextBoxFor(m => m.Title, string.Empty, new { @class = "form-control", @placeholder = "Titel", @style = "width: 100% !important", @value = "" })
        </div>
        <div class="form-group col-lg-12">
            @Html.TextAreaFor(m => m.Message, 5, 10, new { @class = "form-control", @placeholder = "Meddelande", @value = "" })

        </div>
        <div class="col-lg-6" style="padding: 0 !important;">
            <label class="btn btn-block btn-success" id="file-upload">
                Lägg till fil
                <input type="file" name="File" id="File" class="btn btn-group-sm" hidden style="display: none !important;">
            </label>
            @*<button class="btn btn-block btn-success" style="display: none;" id="change-file">Byt fil</button>*@
        </div>

        <div class="col-lg-6">
            <button id="send-message" class="btn btn-block btn-primary" style=" margin-left: 0.1%;">Skicka</button>
        </div>
        <small id="file-path"></small>



    </div>

}



<div class="container">
    <div class="row">
        <!-- Blog Entries Column -->
        <div class="col-md-8">
            <h1 class="page-header">
                Formell Blogg
                <small>Se alla poster</small>
            </h1>


            
            @for (int i = 0; i < Model.Posts.Count(); i++)
            {
            <div class="post" style="border: 1px solid #000; padding: 1%; margin: 1%;">
                <h3 class="title">
                    @Model.Posts[i].Title
                    @Html.HiddenFor(m => m.Posts[i].Title)
                </h3>
                <p class="lead">
                    by @Model.Posts[i].Fullname
                    @Html.HiddenFor(m => m.Posts[i].Fullname)
                </p>
                <p>
                    <span class="timestamp glyphicon glyphicon-time"></span> Skapad @Model.Posts[i].Timestamp.ToString()
                    '@Html.HiddenFor(m => m.Posts[i].Timestamp)
                </p>
                <hr>
                <p class="message">
                    @Model.Posts[i].Message
                    @Html.HiddenFor(m => m.Posts[i].Message)
                </p>

                <p>
                    @if (Model.Posts[i].FilePath != null)
                    {
                        <hr />
                        <a class="btn btn-default" href="../@Model.Posts[i].FilePath" download id="DownloadLink">Ladda ner mig</a>
                        <small>@Model.Posts[i].FilePath</small>
                    }
                </p>
                <hr>
                @if (User.IsInRole("admin"))
                {
                    <button type="submit" class="deleteButton btn btn-danger" id="@Model.Posts[i].PostId" value="Delete">Ta bort</button>
                }
            </div>
            }
            
        </div>
    </div>
</div>

@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            $('input[type="file"]').change(function (e) {
                var fileName = e.target.files[0].name;
                $("#file-path").empty();
                $("#file-path").append(fileName + '" har valts.');
            });
            $("#File").on("click", function () {
                $("#File").val("");
            });
        });
        $(".deleteButton").on("click", function (e) {
            var value = e.target.getAttribute("id");
            $.ajax({
                url: "/api/blog/delete",
                type: "Post",
                data: JSON.stringify([value]),
                contentType: "application/json; charset=utf-8",
                success: function () {
                    alert("Inlägget har raderats");
                    location.reload();
                },
                error: function () {
                    alert("Något har gått fel, kontakta systemadmin!");
                }

            }) 

        });
    </script>
}